
  <table style="width:100%">
    <tr>
      <td style="width:50%; vertical-align: top;">
        <div id="original_text" style="background: #eee; padding:10px; border-top-left-radius:10px; border-bottom-right-radius:10px;">
          <div style="font-weight:bold; padding-bottom:10px;">
            <%=tra("Original Text in {language}", :language => "<span dir='ltr'>#{@translation_key.language.name}</span>".html_safe)%>
          </div>
          <div <%=tr8n_dir_attribute_tag%>>
            <%=image_tag("tr8n/left_quote.png") %>
            <%=@translation_key.sanitized_label %>
            <%=image_tag("tr8n/right_quote.png") %>
          </div>

          <% unless @translation_key.description.blank? %>
            <div class="desc" style="border:0px;<%=tr8n_style_directional_attribute_tag('border', 'left', '1px solid #ccc')%>;<%=tr8n_style_directional_attribute_tag('padding', 'left', '5px')%>;">
              <%=@translation_key.description %>
            </div>
          <% end %>
        </div>
      </td>
      <td style="vertical-align: middle; padding:5px;">
        <div class="arrow-right"></div>
      </td>
      <td style="width:50%; vertical-align: top;">
        <div id="tr8n_translator_translation_container">
          <div style="font-weight:bold; padding-bottom:5px;">
            <%=tra("Enter {language} Translation:", :language => tr8n_current_language.native_name)%>
          </div>

          <%= text_area_tag("translation[label]", @translation.label, :id => "tr8n_translator_translation_label", :class => "keyboardInput") %>

          <% if tr8n_current_application.feature_enabled?(:context_rules) and @translation_key.permutable? %>
            <div style="<%=tr8n_style_attribute_tag('float', 'right')%>; font-size:10px; padding:3px;">
              <%=link_to(tra("generate context rules for this phrase"), {:action => :dependencies, :id => @translation_key.id, :origin => params[:origin]}, :class=>"translation_action") %>
            </div>
          <% end %>
        </div>
        <%=tr8n_spinner_tag("tr8n_translator_spinner", "Translating...")%>
      </td>
    </tr>

  </table>

  <div id="tr8n_translator_translation_container">

    <% if @translation_key.allowed_tokens.any? %>
      <div id="tr8n_translator_tokens_simple_view" style="font-size:10px;">
        <div class="small_section_title" style="color: #999; font-size: 10px;">
          <strong><%=tra("Data Tokens")%></strong>
        </div>

        <% @translation_key.allowed_tokens.each do |token| %>
          <%= link_to_function(token.sanitized_name, "Tr8n.UI.Translation.insertToken('#{token.name}');", :title => trla("Click to insert this token above") ) %>
        <% end %>

        <% if false # tr8n_current_language.cases.any? and @translation_key.data_tokens? %>
          <div style="font-size: 10px; padding-top:15px;">
            <%=link_to_function(tra("Click here if the token values depend on the language cases"), "Tr8n.Utils.Effects.hide('tr8n_translator_tokens_simple_view'); Tr8n.Utils.Effects.show('tr8n_translator_tokens_extended_view');")%>
          </div>
          <div id="tr8n_translator_tokens_extended_view" style="display:none">
            <div class="small_section_title" style="color: #999; font-size: 10px;">
              <strong><%=tra("Data Tokens")%></strong>
            </div>
            <div style="height:120px; overflow:auto; padding:2px; border:1px dotted #ccc; background-color:#f9f8f7;">
              <table style="width:100%;">
                <% @translation_key.data_tokens.each do |token| %>
                  <% next unless token.supports_cases? %>
                  <% tr8n_current_language.cases.each do |lcase| %>
                    <tr>
                      <td style="width:10%; padding-right:2px; vertical-align:top;font-size:10px; border-bottom:1px dotted #ccc;">
                        <%= link_to_function(token.sanitized_name_for_case(lcase.keyword), "Tr8n.UI.Translation.insertToken('#{token.name_for_case(lcase.keyword)}');", :title => trla("Click to insert this token above") ) %>
                      </td>
                      <td style="width:90%; vertical-align:top; border-bottom:1px dotted #ccc; font-size:10px;">
                        <div style='padding-bottom:2px'><%=lcase.native_name%></div>
                        <div style="font-size:8px; color:grey; padding-bottom:2px"><%=lcase.description%></div>
                      </td>
                    </tr>
                  <% end %>
                <% end %>
              </table>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <% if @translation_key.decoration_tokens.any? %>
      <div class="small_section_title" style="color: #999; font-size: 10px;">
        <strong><%=tra("Decoration Tokens")%></strong>
      </div>
      <div style="font-size:10px;">
        <% @translation_key.decoration_tokens.each do |token| %>
          <%= link_to_function("[#{token}: ]", "Tr8n.UI.Translation.insertDecorationToken('#{token}');", :title => trla("Click to insert this token above") ) %>
        <% end %>
      </div>
    <% end %>

    <% if tr8n_current_application.feature_enabled?(:context_rules) and @translation_key.implied_tokens.any? %>
      <div id="tr8n_translator_tokens_simple_view" style="font-size:10px;">
        <div class="small_section_title" style="color: #999; font-size: 10px;">
          <strong><%=tra("Implied Tokens")%></strong>
        </div>

        <% @translation_key.implied_tokens.each do |token| %>
          <%= token.sanitized_name %>
        <% end %>
        <div style="color:#888;font-size:9px;padding-top:5px;">
          <%=tra("Implied tokens are used for generating context rules and should not be used in the actual translations.") %>
        </div>
      </div>
    <% end %>

    <% if Tr8n::Config.enable_google_suggestions? and tr8n_current_language.suggestible? and tr8n_current_application.feature_enabled?(:google_suggestions)%>
      <div id="tr8n_google_suggestion_section" style="display:none; padding-top:10px;">
        <div class="small_section_title" style="color: #999; font-size: 10px;">
          <strong><%=tra("Suggested Translation")%></strong>
        </div>

        <div id="tr8n_google_suggestion_container_<%=@translation_key.id%>" style="" class="small_section">
          <%=image_tag("tr8n/left_quote.png", :style=>"text-align:bottom;padding-bottom:5px;") %>
          <a onclick="Tr8n.element('tr8n_translator_translation_label').value=Tr8n.element('tr8n_translation_suggestion_<%=@translation_key.id%>').innerHTML; return false;" href="#">
            <span class="small" id="tr8n_translation_suggestion_<%=@translation_key.id%>" title="<%=trla("Click to insert this suggested translation above")%>"></span>
          </a>
          <%=image_tag("tr8n/right_quote.png", :style=>"text-align:bottom;padding-top:5px;") %>

          <% sanitized_label = @translation_key.tokenless_label.gsub('"', '\"') %>
          <script type="text/javascript">
            (function() {
              Tr8n.UI.Translation.suggest("<%=@translation_key.id %>", "<%=sanitized_label %>", "<%=@translation_key.suggestion_tokens.join(',')%>", "<%=@translation_key.language.google_key%>", "<%=tr8n_current_language.google_key%>");
            })();
          </script>
        </div>
      </div>
    <% end %>

    <% if tr8n_current_application.feature_enabled?(:glossary) and @translation_key.glossary? %>
      <div class="small_section_title">
        <strong><%=tra("Glossary")%></strong>
      </div>

      <div id="tr8n_glossary_<%=@translation_key.id%>" class="small_section">
        <table class="glossary">
          <% @translation_key.glossary.each do |term| %>
            <% border_style = "border-bottom: 1px dotted #ccc;" unless @translation_key.glossary.last == term %>
            <tr style="<%=border_style%>">
              <td class="keyword"><%=term.keyword %></td>
              <td class="description"><%=term.description %></td>
            </tr>
          <% end %>
        </table>
      </div>
    <% end %>
  </div>
  </div>

  <div id="tr8n_translator_buttons_container" class="buttons_container">
    <button type="submit" class="btn-submit" onClick="Tr8n.UI.Translation.submit(); resizeFrame(); return false;">
      <%=tra("Translate")%>
    </button>
  </div>

<script>
  (function() {
    Tr8n.Dispatcher.postMessage({'subject': 'translator', 'action': 'resize', 'width':  600}, '<%=params[:origin]%>');
    Tr8n.element("tr8n_translator_translation_label").focus();
    var label_rect = Tr8n.Utils.elementRect(Tr8n.Utils.element("original_text"));
    Tr8n.Utils.element("tr8n_translator_translation_label").style.height = (label_rect.height - 40) + 'px';
  })();
</script>

<style>
  .arrow-right {
    width: 0;
    height: 0;
    border-top: 30px solid transparent;
    border-bottom: 30px solid transparent;
    border-left: 30px solid #eee;
  }
</style>